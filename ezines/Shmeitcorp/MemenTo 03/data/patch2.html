<!-- saved from url=(0022)http://internet.e-mail -->
<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage Express 2.0">
<title>CodingASM1</title>
</head>

<body bgcolor="#000000" text="#EEEEEE" link="#FFFF00"
vlink="#FFFF00">

<p><font size="5" face="Arial"><strong>Introduction à l'assembleur
x86 ( ASM )</strong></font></p>

<p>&nbsp;</p>

<p><font color="#8080FF" size="3" face="Arial"><strong><u>Un peut
d'histoire... :</u></strong></font></p>

<p><font size="2" face="Arial">John Von Neuman, tout repose sur
cette personne. Considéré comme le plus grand génie de ce siècle
(certains de ses amis et proches pensaient même que s'était un
extra-terrestre qui avait pris une apparence humaine). Il est le
père de l'informatique moderne, c'est de lui que le cyber est né.
A la base il voulait concevoir une machine capable de penser, il
atteindra son but en 1946 en concevant un ordinateur digne de se
nom, programmable et pouvant prendre certaines initiatives
basique. Mais à l'époque ce n'était qu'un balbutiment, il
continua ses travaux chez IBM qui lui doit beaucoup, c'est dans
cette période qu'est adopter le &quot;bit&quot; comme unité de
mesure de mémoire pour ordinateurs. Il fut aussi à l'origine de
la finalisation de travaux mathématique sur la géneration aléatoire
de nombres et autres systemes de probabilitées d'une complexité
extrême, encore mal saisie de nos jours par les plus grands mathématiciens.
Il s'eteind à Washington en février 1957 à l'âge de 53 ans.</font></p>

<p><font size="2" face="Arial">J.VN ayant inventé le bit, tous
les ordinateurs se programmaient bit par bit en binaire. Il
fallait donc faire de fastidieuses convertions pour réussir à
faire des instructions correctes. C'est par cette difficulté à
former un programme que des ingenieurs des laboratoires Bell (à
qui l'on doit aussi le C le C++ quand à lui à été crée par
Bjarné Stroustrup) ont crée l'assembleur. Ce language
permettrai d'assembler differentes instructions avec des mots clés
basiques pour former un programme en programmant la machine
directement mais de façon plus lisible et compréhensible pour
pouvoir developper un programme et de le mettre plus facilement
à jour. L'assembleur etait né...</font></p>

<p><font size="2" face="Arial">Dans ce cours qui s'etendra sur
plusieurs numéros, nous allond étudier l'assembleur, appelé
courament asm.</font></p>

<p>&nbsp;</p>

<p><font color="#8080FF" size="3" face="Arial"><strong><u>Résumé
sur l'asm :</u></strong></font></p>

<p><font size="2" face="Arial">L'assembleur est un language de très
bas niveau, très proche de la machine, on appelle ca un language
machine tout simplement. C'est le language de plus bas niveau qui
existe. C'est pour cette raison qu'il presente plusieurs
avantages :</font></p>

<ul>
    <li><font size="2" face="Arial">Déja, la vitesse d'exécution
        des programmes est la plus rapide qu'il soit, car
        dialoguant directement avec la machine, contrairement à
        des languages plus évolués comme le C qui requiere
        plusieurs conversions qui ralentissent tout. C'est pour
        cela qu'énormement de programmes effectuant beaucoup de
        calculs (tableurs, jeux, I.A, etc...) et programmés dans
        un language évolué ont de petites routines faitent en
        assembleur pour rendre le programme plus rapide dans ces
        passages. Par exemple dans un logiciel de traitement de
        texte, imaginez que le curseur mette 1 seconde avant de
        passer à la ligne sur un gros texte quand on tape sur
        Entrée, pas génial....</font></li>
</ul>

<ul>
    <li><font size="2" face="Arial">Ce language communique
        directement avec le processeur qui est relié au reste de
        la machine. De cette manière on a un contrôle total à
        100% sur toute la configutation, bref, on peut
        absoluement faire tout ce que l'on veut avec son pc.</font></li>
    <li><font size="2" face="Arial">Il n'y a aucune limite. En
        fait la seule limite est humaine car faire un gros projet
        comme un systeme d'exploitation digne d'Unix en
        assembleur serait possible mais utopique vu la difficulté
        de programmation et le temps passer dessus. Imaginez
        Quake3 fait à 100% en assembleur, il serait au moins 10
        à 15% plus rapide. Mais pour un projet petit ou moyen l'assembleur
        reste un exellent choix.</font></li>
</ul>

<ul>
    <li><font size="2" face="Arial">Ce language trouve sa place
        dans beaucoup de languages évolués. Il faut savoir
        aussi que n'importe quel programme est traduit en
        assembleur pour être compris par la machine. En voyant
        ca on comprend vite que ce language peut servir à créer
        un autre language voir même un compilateur performent.</font></li>
</ul>

<ul>
    <li><font size="2" face="Arial">Connaître ce language vous
        feras programmer de façon propre est très organisée.
        De cette façon, même les programmes fait dans des
        languages comme le Visual Basic seront plus logiques et
        performants.</font></li>
</ul>

<p>&nbsp;</p>

<p><font color="#8080FF" size="3" face="Arial"><strong><u>Hardware
:</u></strong></font></p>

<p><font size="2" face="Arial">Comme nous l'avons vu, l'assembleur
est un language machine pour savoir s'en servir il faut connaitre
un minimum sont anatomie, à la machine... :</font></p>

<ul>
    <li><font size="2" face="Arial">La mémoire : Elle sert à
        stocker des informations attendant d'être traitées
        ulterieurement. Il y a deux types de mémoire, la RAM et
        la ROM. Dans la RAM, ont peux lire et écrire des
        informations, quand vous demarrez un programme, c'est là
        qu'il va &quot;s'ecrire&quot; pour être traité. La ROM
        elle n'est que consutable, on ne peut pas écrire dessus
        de façon logicielle, elle sert en fait à demarrer le pc
        car ses données reste constament, une fois la machine
        paramétrée. Dans la RAM il y a ce que l'on appel la mémoire
        conventionnelle (640Ko) et la RAM dite étendue. Les
        premiers Ko réservés à la RAM conventionnelle font 640Ko,
        ceux que Bill gates qualifiait de suffisant pour tout le
        reste de l'histoire informatique, je cite &quot; 640Ko
        should be enough for everyone&quot; et la RAM étendue
        pour le reste de la mémoire pour le stockage de données
        quelconques.</font></li>
</ul>

<ul>
    <li><font size="2" face="Arial">Le processeur : Rassurez vous,
        on ne va voir que les registre. Donc, le processeur
        contient des registres ayant chacun une fonction bien précise
        :</font></li>
</ul>

<ol>
    <li><font size="2" face="Arial">traiter les données venant
        de la mémoire</font></li>
    <li><font size="2" face="Arial">contenir les adresses de début
        de programme, de données, de macro-codes, etc...</font></li>
    <li><font size="2" face="Arial">accumuler des données pour
        leurs traitement</font></li>
    <li><font size="2" face="Arial">etc,etc....</font></li>
</ol>

<p><font size="2" face="Arial">Il existe 8 registres courant :</font></p>

<ol>
    <li><font size="2" face="Arial">L'</font><font
        color="#0080FF" size="2" face="Arial">A</font><font
        size="2" face="Arial">ccumulateur : E</font><font
        color="#0080FF" size="2" face="Arial">A</font><font
        size="2" face="Arial">X } 32 bits / </font><font
        color="#0080FF" size="2" face="Arial">A</font><font
        size="2" face="Arial">X } 16 bits / </font><font
        color="#0080FF" size="2" face="Arial">A</font><font
        size="2" face="Arial">H et </font><font color="#0080FF"
        size="2" face="Arial">A</font><font size="2" face="Arial">L
        } 8 bits</font></li>
    <li><font size="2" face="Arial">La </font><font
        color="#0080FF" size="2" face="Arial">B</font><font
        size="2" face="Arial">ase : E</font><font color="#0080FF"
        size="2" face="Arial">B</font><font size="2" face="Arial">X
        } 32 bits / </font><font color="#0080FF" size="2"
        face="Arial">B</font><font size="2" face="Arial">X } 16
        bits / </font><font color="#0080FF" size="2" face="Arial">B</font><font
        size="2" face="Arial">H et </font><font color="#0080FF"
        size="2" face="Arial">B</font><font size="2" face="Arial">L
        } 8 bits</font></li>
    <li><font size="2" face="Arial">Le </font><font
        color="#0080FF" size="2" face="Arial">C</font><font
        size="2" face="Arial">ompteur : E</font><font
        color="#0080FF" size="2" face="Arial">C</font><font
        size="2" face="Arial">X } 32 bits / </font><font
        color="#0080FF" size="2" face="Arial">C</font><font
        size="2" face="Arial">X } 16 bits / </font><font
        color="#0080FF" size="2" face="Arial">C</font><font
        size="2" face="Arial">H et </font><font color="#0080FF"
        size="2" face="Arial">C</font><font size="2" face="Arial">L
        } 8 bits</font></li>
    <li><font size="2" face="Arial">Les </font><font
        color="#0080FF" size="2" face="Arial">D</font><font
        size="2" face="Arial">onnées : E</font><font
        color="#0080FF" size="2" face="Arial">D</font><font
        size="2" face="Arial">X } 32 bits / </font><font
        color="#0080FF" size="2" face="Arial">D</font><font
        size="2" face="Arial">X } 16 bits / </font><font
        color="#0080FF" size="2" face="Arial">D</font><font
        size="2" face="Arial">H et </font><font color="#0080FF"
        size="2" face="Arial">D</font><font size="2" face="Arial">L
        } 8 bits</font></li>
    <li><font size="2" face="Arial">L' Index de </font><font
        color="#0080FF" size="2" face="Arial">s</font><font
        size="2" face="Arial">ource : E</font><font
        color="#0080FF" size="2" face="Arial">S</font><font
        size="2" face="Arial">I } 32 bits / </font><font
        color="#0080FF" size="2" face="Arial">S</font><font
        size="2" face="Arial">I } 16 bits </font></li>
    <li><font size="2" face="Arial">L' Index de </font><font
        color="#0080FF" size="2" face="Arial">d</font><font
        size="2" face="Arial">estination : E</font><font
        color="#0080FF" size="2" face="Arial">D</font><font
        size="2" face="Arial">I } 32 bits / </font><font
        color="#0080FF" size="2" face="Arial">D</font><font
        size="2" face="Arial">X } 16 bits</font></li>
    <li><font size="2" face="Arial">Le pointeur de pile (</font><font
        color="#0080FF" size="2" face="Arial">s</font><font
        size="2" face="Arial">tack) : E</font><font
        color="#0080FF" size="2" face="Arial">S</font><font
        size="2" face="Arial">P } 32 bits / </font><font
        color="#0080FF" size="2" face="Arial">S</font><font
        size="2" face="Arial">P } 16 bits</font></li>
    <li><font size="2" face="Arial">Le pointeur de </font><font
        color="#0080FF" size="2" face="Arial">b</font><font
        size="2" face="Arial">ase : E</font><font color="#0080FF"
        size="2" face="Arial">B</font><font size="2" face="Arial">P
        } 32 bits / </font><font color="#0080FF" size="2"
        face="Arial">B</font><font size="2" face="Arial">P } 16
        bits</font></li>
</ol>

<p><font color="#EEEEEE" size="2" face="Arial">A l'origine, les
registres courant étaient AX,BX,SP, etc... mais avant l'étendue
à 32 bits. On ajoute donc E devant pour dire <em>Extended</em>,
soit EAX = Accumulateur étendu.</font></p>

<p><font color="#EEEEEE" size="2" face="Arial">Comme on peut le
voir, les quatres registre AX, BX, CX et DX peuvent être divisés
en deux sous-registres de 8 bits, l'octect de poids fort étant
indiqué par la lettre H (Hight) et celui de poid faible par la
lettre L (Low). De cette menière on peut manipuler juste un
morceau de registre mais le restant ne sera pas indépendant, par
exmple si l'on touche à AL, les registres EAX et AX s'en veront
aussi modifier mais AH et AX resteront indépendants.</font></p>

<p>&nbsp;</p>

<p><font color="#8080FF" size="3" face="Arial"><strong><u>Passons
au code source :</u></strong></font></p>

<p><font color="#EEEEEE" size="2" face="Arial">Tout d'abord je
tiens à remercier vivement <em>Kheo</em> pour m'avoir aider à
terminer ce patcheur! </font></p>

<p><font color="#EEEEEE" size="2" face="Arial">Je remerci aussi <em>Neo
BerSerKeR </em>pour l'ASCII :)</font></p>

<p><font color="#EEEEEE" size="2" face="Arial">Dans ce sode
source vous ne comprendrez pas grand chose (si cous êtes
debutant) mais il sera commenté dans les endroits clefs.</font></p>

<p><font color="#EEEEEE" size="2" face="Arial">Voilà le source,
pour le compiler vous aurez besoin du Tasm; de ses fichier Tasm.exe
et Tlink.exe. Le fichier de compilation est fourni</font><font
size="2" face="Arial"> </font><a href="Coding.zip"><font
color="#0000FF" size="2" face="Arial">ici</font></a><font
size="2" face="Arial"> </font><font color="#EEEEEE" size="2"
face="Arial">avec le code source. Comme d' habitude</font><font
color="#EEEEEE" size="3" face="Arial"> </font><font
color="#EEEEEE" size="2" face="Arial">tout ce qui est en rouge
peut être modifier sans problemes :</font></p>

<p align="center"><font color="#FFFFFF" size="2" face="Arial">----------------------------------------[
Début ]----------------------------------------</font></p>
<div align="left">

<pre><font size="2">;code source Alpha et finalisations: Static REvenge 
; moteur du patch revus et corrigé par Kheo </font></pre>
</div><div align="left">

<pre><font color="#53A6A6" size="2">.MODEL TINY
.CODE
.486
ORG 100h
</font><font size="2">;Déclaration de fichier com
;Ici ORG 100h définit l'adresse ou la 1ere instruction du programme va se placer
;Par conséquent qi vous débugger ce prog, la première instruction sera en XXXX:0100</font><font
color="#53A6A6" size="2">

start: jmp main

;------------------------[Zone à modifier]------------------------------*

Nick                 equ     &quot; </font><font color="#FF0000"
size="2">Kheo &amp; Static REvenge</font><font color="#53A6A6"
size="2"> &quot;     ; Ton nick (respecte l'espace entre chaque guillement)
Nom_du_prog          equ     &quot; </font><font color="#FF0000"
size="2">Progdemerde v1.0</font><font color="#53A6A6" size="2"> &quot;          ; Le nom du prog cracké
Type_de_patch        equ     &quot; </font><font color="#FF0000"
size="2">Full !!</font><font color="#53A6A6" size="2"> &quot;                   ; Met ici ce que fait ton patch

filename 	db &quot;</font><font color="#FF0000" size="2">Progz.exe</font><font
color="#53A6A6" size="2">&quot;,0                           ; Nom du fichier à patcher
nb_blocs 	equ </font><font color="#FF0000" size="2">3</font><font
color="#53A6A6" size="2"> 				           ; Nombre de blocs à changer, ici 2
patch_ptr0 	equ </font><font color="#FF0000" size="2">0487Eh    ,488Eh ,4880h</font><font
color="#53A6A6" size="2">  	           ; Offset des octets à patcher
new_val0 	equ </font><font color="#FF0000" size="2">0FFh,0FFh ,0FFh  ,033h,033h,033h,033h</font><font
color="#53A6A6" size="2">  ; Nouvelles valeurs a patcher. Toujours mettre un 0 avant la valeur sinon sa plante avec les caratères alpha. Exemple =&gt; ne pas mettre EBh mais 0EBh. PS: le mieux et quand même de toujours mettre 0 pour + le clareté 
long_bloc0 	equ </font><font color="#FF0000" size="2">2         ,1     ,4	</font><font
color="#53A6A6" size="2">		   ; Longueur le chaque chaîne, MAX = 65535
taille 		equ </font><font color="#FF0000" size="2">458752 </font><font
color="#53A6A6" size="2">				   ; Ecrire ici la taille exacte du fichier à patcher (en octets)!

texte   db &quot;                             </font><font
color="#FF0000" size="2">²</font><font color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;                           </font><font
color="#FF0000" size="2">²²Û</font><font color="#53A6A6"
size="2">&quot;,0dh,0ah
        db &quot;                        </font><font
color="#FF0000" size="2"> ²²²Û</font><font color="#53A6A6"
size="2">&quot;,0dh,0ah
        db &quot;         </font><font color="#FF0000" size="2">²²²²²²²       ²²²²Û                 ²²²²²²²</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;        </font><font color="#FF0000" size="2">²²²²²²²Û     ²²²²²Û                 ²²²²²²²Û</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;       </font><font color="#FF0000" size="2">²²²²ÛÛÛÛ   ²²²²²²²Û                  ÛÛ²²²²Û</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;      </font><font color="#FF0000" size="2">²²²²Û     ²²²²²²²²Û                    ²²²²Û</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;     </font><font color="#FF0000" size="2">²²²²Û    ²²²²²²²²²Û    ²²²²²²²²²²²²    ²²²²Û</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;    </font><font color="#FF0000" size="2">²²²²Û   ²²²²²²²²²²²²²² ²²²²²²²²²²²²Û   ²²²²Û°°°°° Û°°°°°°°°°°°  Û°°°°°°°°°</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;   </font><font color="#FF0000" size="2">²²²²Û  ²²²²²²²²²²²²²²²Û²²²²²ÛÛÛÛÛÛÛÛ   ²²²²Û°°°°°° Û°°°°°°°°°°°° Û°°°°°°°°°°</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot; </font><font color="#FF0000" size="2"> ²²²²²²² ÛÛÛÛÛ²²²²²²²²²Û²²²²²Û       ²²²²²²²Û ÛÛ°°°° Û°°ÛÛÛÛÛÛÛ°°° Û°°°°ÛÛÛÛ°°</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot; </font><font color="#FF0000" size="2">²²²²²²²Û     ²²²²²²²²ÛÛ²²²²²Û       ²²²²²²²Û   Û°°°° Û°°°°°°°°°°°° Û°°°°°°°°°°</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;</font><font color="#FF0000" size="2"> ÛÛÛÛÛÛÛ     ²²²²²²²ÛÛ ²²²²²Û        ÛÛÛÛÛÛÛ    Û°°°° Û°°°°°°°°°°ÛÛ Û°°°°°°°°°Û</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;</font><font color="#FF0000" size="2">            ²²²²²²ÛÛ  ²²²²²Û           Û°°°°    Û°°°° Û°°° Û°°°°Û   Û°°°°°ÛÛÛÛ</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;</font><font color="#FF0000" size="2">           ²²²²²ÛÛ   ²²²²²²²²²²²²      Û°°°°°°°°°°°°° Û°°°  Û°°°°   Û°°°°</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;</font><font color="#FF0000" size="2">          ²²²²ÛÛ    ²²²²²²²²²²²²Û      Û°°°°°°°°°°°°° Û°°°   Û°°°°  Û°°°°</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;</font><font color="#FF0000" size="2">         ²²²ÛÛ      ÛÛÛÛÛÛÛÛÛÛÛÛ       ÛÛÛÛÛÛÛÛÛÛÛÛÛÛ ÛÛÛÛ    ÛÛÛÛ  ÛÛÛÛÛ  N.B</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;</font><font color="#FF0000" size="2">        ²²ÛÛ</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;</font><font color="#FF0000" size="2">       ²ÛÛ</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah
        db &quot;</font><font color="#FF0000" size="2">       Û</font><font
color="#53A6A6" size="2">&quot;,0dh,0ah




;-----------------------------------------------------------------------*

        db &quot;			Crack for  : &quot;,Nom_du_prog,&quot;&quot;,0dh,0ah
	db &quot;			Crack type : &quot;,Type_de_patch,&quot;&quot;,0dh,0ah
	db &quot;			Cracked by : &quot;,Nick,&quot;&quot;,0dh,0ah,&quot;$&quot;

done 	db &quot;CraCk SuccSessFuL!&quot;,0dh,0ah,&quot;$&quot;

error 	db &quot;An error as appear!&quot;,0dh,0ah,&quot;$&quot;
Error1 	db 0dh,0ah,&quot;Erreur : le fichier a patcher ne fait pas la bonne taille !&quot;,0dh,0ah,&quot;$&quot;
Error2 	db 0dh,0ah,&quot;Erreur : le fichier a patcher est introuvable !&quot;,0dh,0ah,&quot;$&quot;


;-------------------------[NE PAS MODIFIER A LA SUITE!]----------------------------*
handle dw 0
patch_ptr 	dd patch_ptr0 
new_val 	db new_val0 
long_bloc 	dw long_bloc0 
cmpt 		db 0
ptr_val 	dw 0
ptr_patch 	dw 0
ptr_long 	dw 0

;-----------------------------------------------------------------------* 

main:

  mov ah, 9
  lea dx, texte 
  int 21h
</font><font color="#EEEEEE" size="2">; affichage d'une chaine de caractère.</font><font
color="#53A6A6" size="2">

  call openfile
  call patch
  call closefile

  mov ax, 4C00h
  int 21h
</font><font color="#EEEEEE" size="2">; le programme se fini ici si tout c'est bien passé !</font><font
color="#53A6A6" size="2">

openfile:
</font><font color="#EEEEEE" size="2">; Cette procédure permet d'ouvrir le fichier et de retourner le handle de celui ci dans [handle]
; Si le fichier ne peut etre ouvert alors elle envoie un message d'erreur et termine le programme
; enfin elle teste la taille du fichier de manière à pas se tromper .
</font><font color="#53A6A6" size="2">
  mov ax, 4300h
  lea dx, filename
  int 21h
  jc erreur2
</font><font color="#EEEEEE" size="2">; lecture des attribut du fichier. Permet de savoir s'il existe ...</font><font
color="#53A6A6" size="2">
</font><font color="#EEEEEE" size="2">;OUT:
; ecx contient ces attribut
; si erreur alors CF = 1</font><font color="#53A6A6" size="2">

  mov ah, 3Dh
  mov al, 11000010b
  lea dx, filename
  int 21h
  jc erreur
</font><font color="#EEEEEE" size="2">; Ouvre un fichier
;IN:
; AL mode d'acces
;OUT:
; CF = 1 -&gt; error
; CF=0 -&gt; AX= handle du fichier</font><font color="#53A6A6"
size="2">

  mov [handle],ax

  mov ah, 42h
  mov al, 02h
  mov bx, [handle]
  xor cx, cx
  xor dx, dx
  int 21h
</font><font color="#EEEEEE" size="2">; ici j'appelle la fonction pour deplacer le pointeur dans le fichier.
; al=2 -&gt; je me refère par rapport à la fin du file et je met 0 0 cx, dx
; de cette manière l'int 2 va positionner le ptr à la fin du fichier et
; me renvoyer ca taille dans dx,ax
</font><font color="#53A6A6" size="2">

  xor bx, bx
  mov bx, dx
  imul ebx, 010000h
  mov bx, ax
</font><font color="#EEEEEE" size="2">; ici je recupère la taille et je la passe sur un registre 32 bits
; pour pouvoir la comparer avec la variable taille
</font><font color="#53A6A6" size="2">
  cmp ebx, taille
  jnz erreur1
</font><font color="#EEEEEE" size="2">; Si ca n'est pas egal alors erreur !</font><font
color="#53A6A6" size="2">
  ret

closefile:

  mov ax, 3E00h
  mov bx, [handle]
  Int 21h
</font><font color="#EEEEEE" size="2">; ferme le fichier et libère le handle </font><font
color="#53A6A6" size="2">
  jc erreur
  ret

;-------------------------- Gestion des erreurs ------------------------*

erreur2:
  lea dx, error2
  jmp er
erreur1:
  lea dx, error1
  jmp er
erreur:
  lea dx, error
  jmp er

er:
  mov ah, 9 
  int 21h 

</font><font color="#EEEEEE" size="2">; affiche un message d'erreur</font><font
color="#53A6A6" size="2">
  mov ax, 4C01h
  int 21h
</font><font color="#EEEEEE" size="2">; termine le prog avec le code d'erreur 1</font><font
color="#53A6A6" size="2">


;-------------------- Routine d'ecriture du patch ----------------------*
patch:

  mov ptr_val, offset new_val
  mov ptr_patch, offset patch_ptr
  mov ptr_long, offset long_bloc
</font><font color="#EEEEEE" size="2">; recupère les adresse des variables, de manière à pouvoir les incrémenter pour pointer plus loin</font><font
color="#53A6A6" size="2">

bc:
  mov ah, 42h
  xor al, al
  mov bx, [handle]
  mov si, ptr_patch
  mov dx, [si]
  add si, 2
  mov cx, [si]
  int 21h
</font><font color="#EEEEEE" size="2">; deplace le pointeur dans le fichier
;IN:
; cx = poid fort &amp; dx = poid faible
;OUT:
; ax = poid faible &amp; dx = poid fort</font><font
color="#53A6A6" size="2">

</font><font color="#EEEEEE" size="2">; attention en mémoire on lis de gauche à droite, donc le poid faible se lit en premier !</font><font
color="#53A6A6" size="2">
  mov si, ptr_patch
  cmp ax, [si]
  jnz erreur
  add si, 2
  cmp dx, [si]
  jnz erreur
</font><font color="#EEEEEE" size="2">; vérifie si la position dans le fichier est celle voulue ?</font><font
color="#53A6A6" size="2">

  mov ah, 40h
  mov bx, [handle]
  mov si, ptr_long
  mov cx, [si]
  mov si, ptr_val
  mov dx, si
  int 21h
</font><font color="#EEEEEE" size="2">; ici j'écris dans le fichier représenté par le handle [handle] à l'adresse on l'on vient de positionner le ptr
; cx contenant la longueur, le nb de byte à ecrire et ds:dx le ptr sur les byte à ecrire</font><font
color="#53A6A6" size="2">

  inc [cmpt]
  cmp [cmpt],nb_blocs
  jz wrt_ok
</font><font color="#EEEEEE" size="2">; permet de savoir si tout les bytes on été modifié grace à nb_blocs
; etant donné que l'ecriture dans le ficher se fait par blocs de X byte alors il
; faut comparer mon compteur cmpt et nb_bloc</font><font
color="#53A6A6" size="2">

  add ptr_val,cx
  add ptr_patch,4
  add ptr_long,2
</font><font color="#EEEEEE" size="2">; cette partie de code permet de modifier les ptr de manière à ce que la boucle
; modifie les prochains bytes</font><font color="#53A6A6"
size="2">
  jmp bc

wrt_ok:

  mov ah, 9
  lea dx, done
  int 21h 
</font><font color="#EEEEEE" size="2">; affiche le message nous informant que le crack a fonctionné .</font><font
color="#53A6A6" size="2">

  ret

end start</font></pre>
</div>

<p align="left">&nbsp;</p>

<p align="center"><font color="#FFFFFF" size="1" face="Arial">----------------------------------------[
Fin ]-----------------------------------------</font></p>

<p align="left">&nbsp;</p>

<p align="left"><font color="#EEEEEE" size="2" face="Arial">C'est
bon, avec ce programme vous pourrez créer des patchs portables,
compatibles Windows et vous pourrez mettre de supers ASCII :)</font></p>

<p align="left"><font color="#EEEEEE" size="2" face="Arial">Bien
sur, l'assembleur peut parraître fastidieux mais avec un peut de
temps et de pratique on se rend vite compte que c'est un language
assez simple à mettre en oeuvre pour faire de petits programmes.</font></p>

<p align="left"><font color="#EEEEEE" size="2" face="Arial">Si
vous voulez en savoir plus je vais vous conseillez quelques
bouquins et liens :</font></p>

<ul>
    <li><p align="left"><font color="#EEEEEE" size="2"
        face="Arial">L'assembleur, Théorie, pratique et
        exercices.&quot; de Bernard Fabrot aux éditions Marabout,
        toujours à 50 balles. Et oui, je l'ai deja conseiller
        dans le Memento 1 mais ce bouquin est vraiment très bien
        fait.</font></p>
    </li>
    <li><p align="left"><font color="#EEEEEE" size="2"
        face="Arial">L'assembleur, Une découverte pas à pas.&quot;
        de Phillipe Mercier aux éditions Marabout (décidement :)
        aussi à 50 bourzoufs. Ce bouquin contrairement à son
        nom n'est pas tellement bien fait pour debuter mais se
        revelera utile pour ceux qui ont quelques bases.</font></p>
    </li>
    <li><p align="left"><font color="#EEEEEE" size="2"
        face="Arial">Et comme sites web bien fait et traitent du
        sujet, en vrac :</font><font color="#FFFF00" size="2"
        face="Arial"> </font><a href="http://www.win32asm.org"><font
        color="#FFFF00" size="2" face="Arial">www.win32asm.org</font></a><font
        color="#FFFF00" size="2" face="Arial"> </font><a
        href="http://www.multimania.com/w32asm/"><font
        color="#FFFF00" size="2" face="Arial">http://www.multimania.com/w32asm/</font></a><font
        color="#FFFF00" size="2" face="Arial"> </font><a
        href="http://assembly.citeweb.net/"><font color="#FFFF00"
        size="2" face="Arial">http://assembly.citeweb.net/</font></a><font
        color="#FFFF00" size="2" face="Arial"> </font><font
        color="#E5E5E5" size="2" face="Arial">et </font><a
        href="http://www.madchat.org"><font color="#FFFF00"
        size="2" face="Arial">www.madchat.org</font></a><font
        color="#E5E5E5" size="2" face="Arial"> </font><font
        color="#EEEEEE" size="2" face="Arial">pour les tutz
        portant qur le sujet.</font></p>
    </li>
</ul>

<p align="left">&nbsp;</p>

<p align="left"><font color="#EEEEEE" size="3" face="Arial">See
ÿA!</font></p>

<p>&nbsp;</p>

<p align="center">&nbsp; </p>
</body>
</html>
