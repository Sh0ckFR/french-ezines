<html>

<head>
<meta http-equiv="Content-Type"
content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="Microsoft FrontPage Express 2.0">
<title>Comment cracké Picaview.</title>
</head>

<body bgcolor="#000000" text="#EEEEEE" link="yellow">

<h1><font color="#EEEEEE" face="Arial">Picaview v1.31 Fr</font></h1>
<font color="#EEEEEE" size="2">URL: <a href="http://www.acdsystems.com">http://www.acdsystems.com</a></font>
<br><br><br><br>
<p><font color="#EEEEEE" face="Arial"><strong>Intro:</strong></font></p>

<p><font color="#EEEEEE">Picaview est non seulement un petit
programme bien sympathyque, mais il est aussi un très bon exemple
pour commencer à voir de quelle manière peut-on faire croire à
un prog qu'il est enregistrer en détournant des instructions
d'assembleur ;)</font></p>

<p><font color="#EEEEEE">Bien sur, pour bien comprendre ce tut,
mieux vaux avoir quelques bases asm, mais de toute façon,
j'expliquerais le plus simplement possible à quoi sert chaque
instruction cible.</font></p>

<p><font color="#EEEEEE">Ah oui, je vais vous expliquez ma
demarche, alors si ça vous parait un peut bordelique, c'est un
peut normal...</font></p>

<p>&nbsp;</p>

<p><font color="#EEEEEE" face="Arial"><strong>Présentation:</strong></font></p>

<p align="left"><font color="#EEEEEE">Pour cracké Picaview, vous
aurez besoin de: Windasm 8.9, de Hiew 6.x et d'un cerveau asser
bien reveillé ;)</font></p>

<p align="left"><font color="#EEEEEE">Avant tout, demarrons le
programme en lui faisant lire une image via le bouton de droite
de la souris. On peut voir que c'est bien beau, sauf un
&quot;Enregistrer Picaview&quot; qui gache tout le spectacle...
Allons y pour voir ce qu'il s'y passe. Ok, il faut entrer un nom
et un numéro de deblocage, jusque là, c'est classique.
Maintenant entrer un truc bidon dans chaque cellules et cliquez
sur Ok. Si le prog vous dis &quot;Merci de vous être
enregistrer&quot; ou quelque chose du genre, vous avez une veine
pas possible. Par contre, si il vous dis &quot;Votre nom est
votre code d'enregistrement ne correspondent pas.&quot;, alors
c'est là que nous allons intervenir, héhé...</font></p>

<p align="left"><font color="#EEEEEE">Nous avons fait le tour du
code de deverouillage. Maintenant, allons voir dans l'option
&quot;A propos de Picaview...&quot; pour voir aussi ce qu'il s'y
passe. Houlala! Comme c'est moche, un &quot;***COPIE D'EVALUATION
NON ENREGISTREE ***&quot; affiché en gros. Dans cette boîte de
dialogue, il y à aussi trois options. Une pour s'enregistrer
maintenant, une pour activer le rappel plus tard (pour fermer la
boîte quoi), et une pour avoir plus d'info. Au milieu, un
compteur vous indique le nombre d'utilisations faite, et le
nombre de jours restants...</font></p>

<p align="left"><font color="#EEEEEE">Bon, en tant que cracker,
ou si vous avez déjà un peut cracké, on serait tenter de se
dire qu'un simple saut conditionnel est present, et qu'il suffit
de le mettre en inconditionnel pour faire gober au prog qu'il est
enregistrer. Ok, je vous le dis tout de suite c'est le cas, mais
cette fois-ci, il va falloir s'y prendre d'une façon differente
et c'est ce que nous allons voir...</font></p>

<p align="left">&nbsp;</p>

<p align="left"><font color="#EEEEEE" face="Arial"><strong>Launch!</strong></font></p>

<p align="left"><font color="#EEEEEE">Ici je vais utiliser la
méthodes du dead-listing qui consiste à désassembler le
programme pour avoir acces a ses instructions. Cette méthode
n'est plus très en vogue ces dernier temps à causes des
protections de désassemblage qui sont de plus en plus courentes
mais elle constitue un bon départ pour les débutants. Ansi ils
peuvent avoir une vue d'ensemble sur un programme pour analyser
contrètement son fonctionnement. Assez le blabla, passont à des
choses plus sérieuses.</font></p>

<p align="left"><font color="#EEEEEE">Maintenant que nous avons
vu le type de protection, allons dans le repertoire où à été
installer Picaview. Quoi?! pas de fichier exe?! Pas de panique,
si vous avez un minimum de connaissences dans le base de registre
et en programmation windows, vous aurez deviner que Picaview fait
parti integrante du systeme et qu'il est fort possible que sont
contenue se trouve dans un fichier dll. donc, faite une copie de
Picaveiw.dll et désassemblez la avec Windasm, comme ca vous
n'aurez pas besoin de redesassembler le prog' à chaque fois que
vous ferez une modif' ;)</font></p>

<p align="left"><font color="#A0A0A0" size="1">[Interlude...]</font></p>

<p align="left"><font color="#A0A0A0" size="1">J'ai reçus
quelques mails à propos d'un problème d'affichage sous Windasm:
les String data étaient illisibles car les charactères étants
trop espacés. Pour remédier à ce problème, choisissez la
fonte &quot;Courrier&quot; en taille 10.</font></p>

<p align="left"><font color="#A0A0A0" size="1">[Fin de
l'interlude....]</font></p>

<p align="left"><font color="#EEEEEE">Une fois desassembler,
cherchez le message d'erreur &quot;Voter nom est votre code
d'enregistrement ne correspondent pas.&quot;. Hm... il y en à au
moin 10, de plus quand on regarde à la suite aucain Possible
String Data de remerciement style &quot;Merci de vous être
enregistrer....&quot; n'apparait. Bizzard tout ça, de plus, il
serait trop bourrin et trop incertain de tous les modifiés.
Cherchons un autre moyen...</font></p>

<p align="left"><font color="#EEEEEE">Ouvrons une ptite bière,
mettons nous à l'aise, et refléchissons...</font></p>

<p align="left"><font color="#EEEEEE">Si l'on va dans l'Option
&quot;A propos...&quot;, on peut voir qu'un petit compteur y est
present. Nous sommes alors en droit de nous dire que le prog va
chercher la chaine de charactère correspondant au nombres
d'utilisations dans la base de registre de windows. Donc, aller
sous Windasm puis dans les Stringd Data. regardez un peut ce
qu'il y à vers la fin. Là, on voit un jolie &quot;Usage
Count&quot;, ca peut être interressant, car justement, un
compteur d'utilisation est present dans la boite d'enregistrement
=)</font></p>

<p align="left"><font color="#EEEEEE">Double-cliquez dessus pour
voir où il se trouve. Recliquez encore une fois, et oui il y en
à deux, alors lequel choisir? Choisisson le premier dans un
premier temps car le deuxième comporte trop peut de sauts et d'
appellettes de sous routine (je, jne, jz, jmp, call...) alors que
le premeir en à pleins. Nous avons donc plus de chance de
trouver le bon endroit.</font></p>
<div align="left">

<pre>:10011DB0 83EC0C 		sub 	esp, 0000000C
:10011DB3 8D442400 		lea 	eax, dword ptr [esp]
:10011DB7 56 			push 	esi
:10011DB8 8BF1 			mov 	esi, ecx
:10011DBA 50 			push 	eax
:10011DBB 6819000200 		push 	00020019
:10011DC0 8B4E10 		mov 	ecx, dword ptr [esi+10]
:10011DC3 6A00	       		push 	00000000
:10011DC5 51 			push 	ecx
:10011DC6 6802000080 		push 	80000002

<font color="#0000FF">* Reference To: ADVAPI32.RegOpenKeyExA, Ord:0172h</font>
|
:10011DCB FF1508600910 		Call 	dword ptr [10096008]
:10011DD1 85C0 			test 	eax, eax
:10011DD3 7536 			jne 	10011E0B
:10011DD5 8D542408 		lea 	edx, dword ptr [esp+08]
:10011DD9 8D86FC000000 		lea 	eax, dword ptr [esi+000000FC]
:10011DDF 52 			push 	edx
:10011DE0 8B542408	        mov 	edx, dword ptr [esp+08]
:10011DE4 8D4C2410	        lea 	ecx, dword ptr [esp+10]
:10011DE8 50 			push 	eax
:10011DE9 51 			push 	ecx
:10011DEA 6A00 			push 	00000000

<font color="#00FF00">* Possible StringData Ref from Data Obj -&gt;&quot;UsageCount&quot;</font>
|
:10011DEC 68B8AA0A10 		push 	100AAAB8
:10011DF1 52 			push 	edx</pre>
</div>

<p align="left"><font color="#EEEEEE">Au dessus, on peut voir que
Picaveiw ouvre bien à le base de registre windows pour afficher
le compteur de nombres d'utilisations comme nous le montre le </font><font
color="#0000FF">RegOpenKeyExA </font><font color="#EEEEEE">suivit
de</font><font color="#0000FF"> </font><font color="#EEEEEE">&quot;</font><font
color="#008000">UsageCount</font><font color="#EEEEEE">&quot;</font><font
color="#EEEEEE">. On peut voir aussi un saut conditionnel, un </font><font
color="#EAF000">jne 10011E0B</font><font color="#EEEEEE">. </font><font
color="#EEEEEE">Executez ce saut en appuyant sur la touche Jump
To. Vala, il atterit juste après le </font><font color="#0000FF">RegCloseKey</font><font
color="#EEEEEE"> et ne va pas pouvoir lire combien de fois nous
avons executer le programme car il ne serat pas passer par </font><font
color="#0000FF">RegQueryValue</font><font color="#EEEEEE"> </font><font
color="#EEEEEE">pour lire la chaîne de charactere
correspondante. Par curiosité (mieux vaux être curieux quand on
craque), remplaçons ce saut par un saut inconditionnel, qui
quoiqu'il se passe, serat effectuer. Ouvrez donc le fichier
Picaview.dll avec votre editeur héxa prefere, lancez une
recherche sur</font><font color="#EEEEEE"> </font><font
color="#D700D7">24088D4C2410</font><font color="#EEEEEE"> </font><font
color="#EEEEEE">par exmple juste histoire de tomber juste à
coté de ce saut. Ensuite, remplacez </font><font color="#D700D7">7536</font><font
color="#EEEEEE"> </font><font color="#EEEEEE">par </font><font
color="#D700D7">EB36</font><font color="#EEEEEE">. Executez le
prog', allez dans &quot;A propos...&quot; et là, on peux voir
que le compteur à été mis à 1. Bon aller, maintenant que nous
avons vu ce que nous voulions voir, on remet le</font><font
color="#D700D7"> 75</font><font color="#EEEEEE"> à la place du </font><font
color="#D700D7">EB</font><font color="#EEEEEE">.</font></p>

<p align="left"><font color="#EEEEEE">Conclusion, nous sommes
peut être sur la bone voie, car les fenêtre d' &quot;A
propos...&quot; affichent casiment toujours le nom de la personne
enregistrée, et comme nous ne sommes pas enregistrés (pas
encore ;), le prog passe surement par le même endroit car si
l'on regarde un peut en haut et en bas de ce &quot;</font><font
color="#008000">UsageCount</font><font color="#EEEEEE">&quot;, le
prog' sniff un peut trop la base de registre windows avec des </font><font
color="#0000FF">RegOpenKey</font><font color="#EEEEEE"> et
autre... Mais peut être aussi que nous sommes sur la mauvaise
voie. Nous allons voir ça ensemble...</font></p>

<p align="left"><font color="#EEEEEE">Continuons donc notre petit
chemin à travers le listing. Et reprenons le à partir de là
où à sauter le </font><font color="#EAF000">jne 10011DD3</font><font
color="#EEEEEE">, c'est à dire à la ligne </font>10011E0B<font
color="#EEEEEE">. Là, on peut voir un </font><font
color="#EAF000">je</font><font color="#EEEEEE"> et un </font><font
color="#EAF000">jne</font><font color="#EEEEEE"> qui se suivent.
Je ne vais pas trop entrer dans les details mais si l'on execute
ses deux saut on remarque qu'il atterissent au même endroit.</font></p>
<div align="left">

<pre>
<font color="#808080">* Referenced by a (U)nconditional or (C)onditional Jump at Address:
|:10011DD3(C)</font>
|
:10011E0B 8B8604010000            mov 	eax, dword ptr [esi+00000104]
:10011E11 85C0                    test 	eax, eax
:10011E13 7417                    <font color="#FFFF00">je</font> 	10011E2C <font
color="#FF0000">&lt;= Ici</font>
:10011E15 8B4C2414                mov 	ecx, dword ptr [esp+14]
:10011E19 51                      push 	ecx
:10011E1A 8BCE                    mov 	ecx, esi
:10011E1C E8DF140000              call 	10013300
:10011E21 85C0                    test 	eax, eax
:10011E23 7507                    <font color="#FFFF00">jne</font> 	10011E2C <font
color="#FF0000">&lt;= Et ici</font>
:10011E25 5E                      pop 	esi
:10011E26 83C40C                  add 	esp, 0000000C
:10011E29 C20400                  ret 	0004



<font color="#808080">* Referenced by a (U)nconditional or (C)onditional Jump at Addresses:
|:10011E13(C), :10011E23(C)</font>
|
:10011E2C 8BCE                    mov 	ecx, esi
:10011E2E E84D180000              call  10013680  <font
color="#FF0000">&lt;= Joli ca call</font>

<font color="#00FF00">* Possible Reference to String Resource ID=00001: &quot;Affiche les images.&quot;</font>
                                  |
:10011E33 B801000000              mov 	eax, 00000001
:10011E38 5E                      pop 	esi
:10011E39 83C40C                  add 	esp, 0000000C
:10011E3C C20400                  ret 	0004</pre>
</div>

<p align="left"><font color="#EEEEEE">Le premier &quot;passe au
dessus&quot; d'un call, allons voir ce qu'il y à dedans... Bof '
pas terrible mais restons y et decendons un peut. Oh! Mais quue
voit on? Une belle partie pleine d'acces à la base de registre
windows et de jolies String Data tels que &quot;</font><font
color="#30B833">Name</font><font color="#EEEEEE">&quot; ou &quot;</font><font
color="#30B833">SerialNumber</font><font color="#EEEEEE">&quot;.
Interressant tout ça, mais comme nous ne sommes pas encore sur
de l'endroit que nous devons modifier, nous allons en rester là
et sortir de ce call en cliquant sur Ret.</font></p>

<p align="left"><font color="#EEEEEE">Le deuxième saut quand à
lui, ne saute que par dessus un </font><font color="#FF8080">pop
esi</font><font color="#EEEEEE"> comme instruction capable
d'influencer le programme. Mais nous ne savons pas trop ce qu'il
va influencer, alors pour l'instant on en reste là et on observe
la suite du listing...</font></p>

<p align="left"><font color="#EEEEEE">A la suite, on peut voir un
</font><font color="#FFFF00">Call 10013680</font><font
color="#EEEEEE">. aller hop! On entre dedans par simple
curiosité. Oh! Comme c'est étrange, regardez où l'on atteri!</font></p>
<div align="left">

<pre>
<font color="#808080">* Referenced by a CALL at Address:</font>
|:<font color="#FF80C0">10011E2E</font> <font color="#FF80C0">&lt;= Le seul</font>
|
:10013680 81EC20010000 		sub 	esp, 00000120
:10013686 53 			push 	ebx
:10013687 56 			push 	esi
:10013688 8BF1		        mov 	esi, ecx
:1001368A 57 			push 	edi
:1001368B 8B464C 		mov 	eax, dword ptr [esi+4C]
:1001368E 85C0 			test 	eax, eax
:10013690 0F8E66010000 		jle 	100137FC
:10013696 8B4E10 		mov 	ecx, dword ptr [esi+10]
:10013699 8D442410 		lea 	eax, dword ptr [esp+10]
:1001369D 50 			push 	eax
:1001369E 6819000200 		push 	00020019
:100136A3 6A00 			push 	00000000
:100136A5 51 			push 	ecx
:100136A6 6802000080 		push 	80000002

<font color="#0000FF">* Reference To: ADVAPI32.RegOpenKeyExA, Ord:0172h</font>
|
:100136AB FF1508600910 		Call 	dword ptr [10096008]
:100136B1 85C0 			test 	eax, eax
:100136B3 0F8543010000 		jne 	100137FC
:100136B9 8A15283B0B10 		mov 	dl, byte ptr [100B3B28]

<font color="#00FF00">* Possible Reference to String Resource ID=00009: &quot;A propos de PicaView&quot;</font>
|
:100136BF B909000000 		mov 	ecx, 00000009
:100136C4 8D7C2439 		lea 	edi, dword ptr [esp+39]
:100136C8 88542438 		mov 	byte ptr [esp+38], dl
:100136CC F3 			repz
:100136CD AB 			stosd
:100136CE 66AB 			stosw
:100136D0 AA 			stosb</pre>
</div>

<p align="left"><font color="#EEEEEE">Vous avez vu? C'est peut
être ce call que Picaview va appeller pour analiser le nom et le
code d'enregistrement. Pourquoi? Tous simplement parceque comme
nous l'indique Windasm, c'est </font><font color="#FF80C0">le
seul</font><font color="#EEEEEE"> call qui appel cette partie du
listing bien qu'il en ai plusieurs de même type. Nous allons
voir pourquoi c'est cette partie qui pourrait nous interresser...</font></p>

<p align="left"><font color="#EEEEEE">Si vous descendez verez un </font><font
color="#0000FF">RegQueryValueExA</font><font color="#EEEEEE"> qui
va lire les chaines de charatecteres pour &quot;</font><font
color="#30B833">Name</font><font color="#EEEEEE">&quot; et &quot;</font><font
color="#30B833">SerialNumber</font><font color="#EEEEEE">&quot;
afin de determiner si ces donées sont bonnes ou mauvaises. On
peut voir aussi un peut plus bas un magnifique &quot;</font><font
color="#30B833">Enregistrer Picaview...</font><font
color="#008000">.</font><font color="#EEEEEE">&quot;. Donc,
rappellez vous bien, notre but est de faire croire au prog' qu'il
est enregistrer, pas de lui faire dire que le mot de passe est
bon. </font></p>

<p align="left"><font color="#EEEEEE">La seule partie la plus
interressente est le </font><font color="#EAF000">call 10013680</font><font
color="#EEEEEE"> où nous etions . Revenons-y car comme on peut
le constater, aucun saut conditionnel est présent. Un peut plus
bas un </font><font color="#EAF000">jne 10011E6A </font><font
color="#EEEEEE">est present,</font><font color="#EEEEEE"> et
comme c'est un court pour débutants, je ne vais pas trop entrer
dans les details pour l'instant pour vous preciser la definition
des instrutions </font><font color="#FF8080">pop</font><font
color="#EEEEEE"> qu'il saute et simplement vous dire qu'elles
servent à vider differents </font><a href="#1"><font
color="#0000FF">registres</font></a><font color="#EEEEEE"> de</font><font
color="#0000FF"> </font><a href="#1"><font color="#0000FF">la
pile</font></a><font color="#EEEEEE"> :)</font></p>

<p align="left"><font color="#EEEEEE">A la suite, on peut voir un
</font><font color="#EAF000">call 10011E72</font><font
color="#EEEEEE">, et comme d' abitude, allons voir ce qu'il
cache. Bof', pas terrible...</font></p>

<p align="left"><font color="#EEEEEE">Bon, maintenant sortons de
ce call car ce n'est apparement pas l'endroit tant rechercher. On
peut voir un </font><font color="#EAF000">jne 10011F20</font><font
color="#EEEEEE">, en l'executant, on peut voir qu'il atteri à un
endroit où si l'on regarde un peut plus bas, on remarque grâce
aux String Data et autres qu' encore pas mal de processus de
verification du mot de passe sont présent, mais apparement ce
n'est que pour lire le code et le mot de passe et les fare
condordés. Donc on s'en fou et on reviens sur le </font><font
color="#EAF000">jne 10011F20</font><font color="#EEEEEE">. On
voit un </font><font color="#EAF000">call 10013AD0</font><font
color="#EEEEEE"> on entre dedans, et bof', ya pas grand chose de
flagrant et aucun String Data n'est present pour prendre des
points de repères. Un &quot;Afficher les images.&quot; est
présent, en ressortant de ce call, un peut voir que le même
String est marquer en dessous, hm... interressant...</font></p>

<p align="left"><font color="#EEEEEE">Ensuite, on peut voir au
dessus et en dessous du même </font><font color="#EAF000">call
10013AD0 </font><font color="#EEEEEE">un </font><font
color="#EAF000">jne 10011F20 </font><font color="#EEEEEE">et un </font><font
color="#EAF000">je 10011EAD</font><font color="#EEEEEE"> qui
sautent au dessus de trois instructions </font><font
color="#FF8080">pop</font><font color="#EEEEEE"> (</font><font
color="#FF8080">pop edi, pop esi, pop ebp</font><font
color="#EEEEEE">). Et là, STOP!! Vous allez voir pourquoi.</font></p>

<p align="left"><font color="#EEEEEE">Et oui, ceux (ou celles)
qui connaissent l'astuce, auront remarqués pendant ce tout petit
trajet que quelques lignes sont très importantes. Les voilà:</font></p>
<div align="left">

<pre><font color="#808080">* Referenced by a CALL at Address:
|:100063A9 </font>
|
:10011DB0 83EC0C 		sub 	esp, 0000000C
:10011DB3 8D442400 		lea 	eax, dword ptr [esp]
:10011DB7 56 			push 	esi
:10011DB8 8BF1 			mov 	esi, ecx
:10011DBA 50 			push 	eax
:10011DBB 6819000200 		push 	00020019
:10011DC0 8B4E10 		mov 	ecx, dword ptr [esi+10]
:10011DC3 6A00 			push 	00000000
:10011DC5 51 			push 	ecx
:10011DC6 6802000080 		push 	80000002

<font color="#0000FF">* Reference To: ADVAPI32.RegOpenKeyExA, Ord:0172h</font>
|
:10011DCB FF1508600910 		Call 	dword ptr [10096008]
:10011DD1 85C0 			test	eax, eax
:10011DD3 7536 			jne 	10011E0B	<font color="#FF0000">&lt;= Bien sympat</font>
:10011DD5 8D542408 		lea 	edx, dword ptr [esp+08]
:10011DD9 8D86FC000000 		lea 	eax, dword ptr [esi+000000FC]
:10011DDF 52 			push 	edx
:10011DE0 8B542408 		mov 	edx, dword ptr [esp+08]
:10011DE4 8D4C2410 		lea 	ecx, dword ptr [esp+10]
:10011DE8 50 			push	eax
:10011DE9 51 			push	ecx
:10011DEA 6A00 			push	00000000

<font color="#0000FF">* Possible StringData Ref from Data Obj -&gt;&quot;UsageCount&quot; </font><font
color="#FF0000">&lt;= Compteur du 
                                                          nombres
						          d'utilisations</font><font color="#0000FF">
</font>
|
:10011DEC 68B8AA0A10 		push 	100AAAB8
:10011DF1 52 			push 	edx</pre>
</div>

<p align="left">&nbsp;</p>

<p align="center">[....]</p>

<p align="center">&nbsp;</p>
<div align="left">

<pre><font color="#808080">* Referenced by a CALL at Addresses:
|:10012051 , :10012E41 </font>
|
:10011E40 83EC24 		sub 	esp, 00000024
:10011E43 53 			push 	ebx
:10011E44 55 			push 	ebp
:10011E45 56 			push 	<font color="#FF8080">esi</font>
:10011E46 8B742434 		mov 	<font color="#FF8080">esi</font>, dword ptr [<font
color="#FF8080">esp+34</font>]
:10011E4A 57 			push	<font color="#FF8080">edi</font>
:10011E4B 8BF9 			mov <font color="#FF8080">	edi</font>, ecx
:10011E4D 56 			push 	<font color="#FF8080">esi</font>
:10011E4E 897C2414 		mov 	dword ptr [<font color="#FF8080">esp+14</font>], <font
color="#FF8080">edi</font>
:10011E52 E8391C0000 		call 	10013A90
:10011E57 83C404 		add 	<font color="#FF8080">esp</font>, 00000004
:10011E5A 85C0 			<font color="#0080FF">test 	eax, eax</font>
:10011E5C 750C 			<font color="#FFFF00">jne 	10011E6A</font>	<font
color="#FF0000">&lt;= C'est très beau ca!</font>

<font color="#808080">* Referenced by a (U)nconditional or (C)onditional Jump at Address:
|:10011EB4(C)</font>
|
:10011E5E 5F 			pop 	edi
:10011E5F 5E 			pop 	esi
:10011E60 5D 			pop 	ebp
:10011E61 33C0 			<font color="#0080FF">xor 	eax, eax</font>
:10011E63 5B 			pop 	ebx
:10011E64 83C424 		add 	esp, 00000024
:10011E67 C20C00 		ret 	000C</pre>
</div>

<p align="left"><font color="#EEEEEE">Dans ces passages, ont peut
voir que l'instruction</font><font color="#EEEEEE"> </font><font
color="#FF8080">push</font><font color="#EEEEEE"> </font><font
color="#EEEEEE">est justement utiliser pour les registres</font><font
color="#EEEEEE"> </font><font color="#FF8080">edi</font><font
color="#EEEEEE">,</font><font color="#FF8080"> esi</font><font
color="#EEEEEE"> </font><font color="#EEEEEE">et</font><font
color="#EEEEEE"> </font><font color="#FF8080">ebp</font><font
color="#EEEEEE"> </font><font color="#EEEEEE">qui vont servir à
mettre une valeur en mémoire pour être manipulés par la suite
(nom d'enregistrement, code, ...). Et si vous avez bien tout
suivi, vous comprendrez mieux que les </font><font
color="#FF8080">pop edi</font><font color="#EEEEEE">,</font><font
color="#FF8080"> pop esi </font><font color="#EEEEEE">et</font><font
color="#FF8080"> pop ebp</font><font color="#EEEEEE"> sur lequel
nous sommes atteris sont important puisque même si le prog vois
un code faux dans la base de registre, il va le considérrer
comme bon. Pourquoi? Car une fois les registres de test vidés
(à part </font><font color="#0080FF">eax</font><font
color="#EEEEEE"> qui dois toujours être là puisqu'il joue le
rôle d'un accumulateur), le prog va sauter par dessus la
procedure qui gere les parametres de non enregitrement. De cette
façon, Picaview va empreinter la bonne voie pour qu'il soit
enregistrer en permanence.</font></p>

<p align="left"><font color="#EEEEEE" size="3">Bon, en gros c'est
ca pour pas trop entrer dans les details. Si vous avez mal
compris ce passage, relisez-le bien, il est très important.</font></p>

<p align="left"><font color="#EEEEEE" size="3">Alors certains
diront &quot;Ok, mais il y avait deja tous ces </font><font
color="#FF8080" size="3">pop</font><font color="#EEEEEE" size="3">
juste en dessous du</font><font color="#EAF000" size="3"> jne
10011EAD</font><font color="#EEEEEE" size="3">.&quot;. Je leurs
dirais que je suis tout a fait d'accord, mais si l'on fait en
sorte de remplacer ces saut pour qu'ils ne soient jamais
effectuer (</font><font color="#D700D7" size="3">750F</font><font
color="#EEEEEE" size="3"> </font><font color="#EEEEEE" size="3">par</font><font
color="#EEEEEE" size="3"> </font><font color="#D700D7" size="3">7500</font><font
color="#EEEEEE" size="3"> </font><font color="#EEEEEE" size="3">ou
</font><font color="#D700D7" size="3">9090 </font><font
color="#EEEEEE" size="3">et</font><font color="#D700D7" size="3">
</font><font color="#D700D7">0F859A000000</font><font
color="#EEEEEE"> par </font><font color="#D700D7">0F8500000000</font><font
color="#EEEEEE"> ou </font><font color="#D700D7">909090909090</font><font
color="#EEEEEE" size="3">)</font><font color="#EEEEEE" size="3">
et que les </font><font color="#FF8080" size="3">pop</font><font
color="#EEEEEE" size="3"> soient pris en compte, Window$ va
afficher un beau message d'erreur sur l'état de la pile de
registre, puisque les registres auronts deja étés vider. Ils
vont alors se vider une fois de plus, mais vider quoi??? Picaview
va donc planter en beauter au lieu d'afficher le message de
rappel d'enregistrement...</font></p>

<p align="left"><font color="#EEEEEE" size="3">Et c'est là que
nous allons voir comment résoudre ce probème en utilisant
l'ultime outil pour modifier un programme en asm...</font></p>

<p align="left">&nbsp;</p>

<p align="left"><font color="#EEEEEE" face="Arial"><strong>Hiew !</strong></font></p>

<p align="left"><font color="#EEEEEE">Alors nous, tout ce que
l'on veux c'est faire gober au prog' qu'il est enregistrer, et
pour mieux suivre, je vous mets la partie du listing la plus
importante :</font></p>
<div align="left">

<pre><font color="#808080">* Referenced by a CALL at Addresses:
|:10012051   , :10012E41   </font>
|
:10011E40 83EC24                  sub 	esp, 00000024
:10011E43 53                      push 	ebx
:10011E44 55                      push 	ebp
:10011E45 56                      push	esi
:10011E46 8B742434                mov 	esi, dword ptr [esp+34]
:10011E4A 57                      push 	edi
:10011E4B 8BF9                    mov 	edi, ecx
:10011E4D 56                      push 	esi
:10011E4E 897C2414                mov 	dword ptr [esp+14], edi
:10011E52 E8391C0000              call 	10013A90
:10011E57 83C404                  add 	esp, 00000004
:10011E5A 85C0                    test 	eax, eax
:10011E5C 750C                    <font color="#FFFF00">jne 	10011E6A</font> <font
color="#FF0000">&lt;= LE saut</font>

<font color="#808080">* Referenced by a (U)nconditional or (C)onditional Jump at Address:
|:10011EB4(C)</font>
|
:10011E5E 5F                      pop 	edi
:10011E5F 5E                      pop 	esi
:10011E60 5D                      pop 	ebp
:10011E61 33C0                    xor 	eax, eax
:10011E63 5B                      pop 	ebx
:10011E64 83C424                  add 	esp, 00000024
:10011E67 C20C00                  ret 	000C



<font color="#808080">* Referenced by a (U)nconditional or (C)onditional Jump at Address:
|:10011E5C(C)</font>
|
:10011E6A 8D442414                lea eax, dword ptr [esp+14]

<font color="#00FF00">* Possible Reference to String Resource ID=00001: &quot;Affiche les images.&quot;</font>
                                  |
:10011E6E 6A01                    push 	00000001
:10011E70 50                      push 	eax
:10011E71 56                      push 	esi
:10011E72 E8591F0000              call 	10013DD0
:10011E77 8B4720                  mov 	eax, dword ptr [edi+20]
:10011E7A 83C40C                  add 	esp, 0000000C
:10011E7D 80382D                  cmp 	byte ptr [eax], 2D
:10011E80 0F859A000000            jne 	10011F20
:10011E86 8B4C2440                mov 	ecx, dword ptr [esp+40]
:10011E8A 8B5C243C                mov 	ebx, dword ptr [esp+3C]
:10011E8E 51                      push 	ecx
:10011E8F 53                      push 	ebx
:10011E90 56                      push 	esi
:10011E91 50                      push 	eax
:10011E92 E8391C0000              call 	10013AD0
:10011E97 83C410                  add 	esp, 00000010
:10011E9A 85C0                    test 	eax, eax
:10011E9C 740F                    je 	10011EAD
:10011E9E 5F                      pop 	edi <font color="#FF0000">&lt;= La cible</font>
:10011E9F 5E                      pop 	esi <font color="#FF0000">&lt;</font>
:10011EA0 5D                      pop 	ebp <font color="#FF0000">&lt;</font>

<font color="#00FF00">* Possible Reference to String Resource ID=00001: &quot;Affiche les images.&quot;</font>
                                  |
:10011EA1 B801000000              mov 	eax, 00000001
:10011EA6 5B                      pop 	ebx
:10011EA7 83C424                  add 	esp, 00000024
:10011EAA C20C00                  ret 	000C</pre>
</div>

<p align="left"><font color="#EEEEEE">Donc, nous voulons que le
prog passe par ces </font><font color="#FF8080">pop</font><font
color="#EEEEEE"> histoire de le carotte un max ;) Là, deux
solutions s'offrent à nous:</font></p>

<p align="left"><font color="#EEEEEE"><strong>1</strong>/ Celle
du cracker limite bourrin qui va nopper le </font><font
color="#FFFF00">jne</font><font color="#EEEEEE"> et le </font><font
color="#FFFF00">je</font><font color="#EEEEEE">, c'est à dire
remplacer avec son editeur héxadécimal, le </font><font
color="#D700D7">0F859A000000</font><font color="#EEEEEE"> par des
</font><font color="#D700D7">909090909090</font><font
color="#EEEEEE"> et le </font><font color="#D700D7">740F</font><font
color="#EEEEEE"> par des </font><font color="#D700D7">9090</font><font
color="#EEEEEE">. Pas très jolie tout ca...Et en plus comme nous
l'avons vu plus haut, ca fait planter le prog.</font></p>

<p align="left"><font color="#EEEEEE"><strong>2</strong>/ Celle
du cracker qui connais asser bien ce type de protection pour
faire gober ce qu'il veux au prog'. De plus, il ne faudra alors
modifier que deux octets, et au lieu de 8 sois quatre fois moin,
ca l' fait non?</font></p>

<p align="left"><font color="#EEEEEE">Perso, je prefere la
deuxième solution qui est bien plus classe. Pour ce faire, on
regarde un peut plus haut dans le listing histoire de chercher un
ptit saut inconditionnel ou non bien placé de façon à le
bidouiller pour qu'il parte directement sur les </font><font
color="#FF8080">pop</font><font color="#EEEEEE"> (dans le
prochain numero, nous verons comment faire pour fabriquer son
propre saut =).</font></p>

<p align="left"><font color="#EEEEEE">On monte donc un peut dans
le listing, et là on vois le beau </font><font color="#EAF000">jne
10011E6A</font><font color="#EEEEEE"> (</font><font
color="#D700D7">750C</font><font color="#EEEEEE">) qui ne se
trouve pas bien loingt, et qui pourrait bien sauter toute cette
marmaille pour atterir directement aux fameux </font><font
color="#FF8080">pop edi</font><font color="#EEEEEE">,</font><font
color="#FF8080"> pop esi </font><font color="#EEEEEE">et</font><font
color="#FF8080"> pop ebp</font><font color="#EEEEEE"> signalés
sur le listing ci-dessus. Mais comment faire?</font></p>

<p align="left"><font color="#EEEEEE">C'est là que vous avez
besoin d'executer Hiew et d'ouvrir le fichier Picaview.dll avec
F9 puis d'appuyer deux fois sur Entrée pour voir le listing asm.
Maintenant lancez avec F7 une recherche en héxadécimal sur le </font><font
color="#D700D7">E8391C0000 </font><font color="#EEEEEE">correspondant
au </font><font color="#EAF000" size="3">call 10013DD0 </font><font
color="#EEEEEE">qui se trouve juste à coté du </font><font
color="#EAF000">jne 10011E6A</font><font color="#EEEEEE"> (</font><font
color="#D700D7">750C</font><font color="#EEEEEE">). Une fois
dessus, appuyer sur F3, puis sur F2 pour pouvoir faire les
modifications asm, et là, remplacer </font><font color="#EAF000">jne
10011E6A</font><font color="#EEEEEE"> par </font><font
color="#EAF000">jmps 10011E9E</font><font color="#EEEEEE"> (</font><font
color="#D700D7">EB40</font><font color="#EEEEEE">) car cette
longueure de saut va nous faire atterrir à l'endroit où tous
les </font><font color="#FF8080">pop</font><font color="#EEEEEE">
se trouvent, à partir de l'adresse </font>10011E9E<font
color="#EEEEEE" size="3">. De cette manière, le prog serat
toujours enregistrer puisque de cette façon, on saute par dessus
la gestion de non-enregistrement bien proprement en se servant
d'une faille du programme =)</font></p>

<p align="left"><font color="#EEEEEE" size="3">Voilà, j'espere
avoir été le plus clair possible pour ce tutorial. J'aurai bien
voulu detailler plus, mais ca n'aurai fait que compliquer les
choses :p</font></p>

<p align="left"><font color="#EEEEEE" size="3">Aller, amusez vous
bien!</font></p>

<p align="left"><font color="#EEEEEE" size="3">NB: Si vous voulez
mettre votre nom dans la cellulue d'enregistrement, ouvrez ce </font><a
href="picareg.reg"><font color="#0000FF" size="3">fichier reg</font></a><font
color="#EEEEEE" size="3"> avec Notepad, changer le nom puis
enregistrer. Enfin, executez-le et répondez oui à la question
;)</font></p>

<p align="center">&nbsp;</p>

<p align="center"><font color="#EEEEEE" size="3">_-_-_-_-_-_-_-_-_-_-_-_-_-_-tEChNO
pHr3aCKs-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_</font></p>

<p><a name="1"></a><font color="#EEEEEE" size="3"><u>La pile</u>:
C'est un tableau de type LIFO (Last In First Out). Le registre de
segment SS (Statck Segment) pointe sur le début de la pile
tandis que le registre SP (Stack Pointe) indique le position du
dernier élément placé sur cette pile. L'ordinateur à besoin
de cette pile à chaque fois qu'une rupture se produit dans un
programme (appel de sous routine, interruption, ...). Il sauve l'
addresse avec laquelle il doit continuer le programme une fois
cette rupture terminé. Voici un exemple très simplifié en
assembleur 32bits :</font></p>
<div align="left">

<pre><font color="#EEEEEE" size="2">.data					; Indique la zone de données
</font><font color="#8080FF" size="2">txt</font><font
color="#EEEEEE" size="2"> db &quot;Partagez votre savoir.&quot;,0  	; Ici le label </font><font
color="#8080FF" size="2">txt</font><font color="#EEEEEE" size="2"> &quot;attend&quot;
                                        ; d'être dans la pile
.code                                   ; Indique la zone de code
</font><font color="#FF80FF" size="2">push</font><font
color="#EEEEEE" size="2"> offset </font><font color="#8080FF"
size="2">txt</font><font color="#EEEEEE" size="2">   			; Ici on </font><font
color="#FF80FF" size="2">pousse</font><font color="#EEEEEE"
size="2"> txt dans la pile
call MessageBoxA 			; On appel la procedure d'affichage
                                        ; d'une boite de dialogue.
                                        ; La phrase de </font><font
color="#8080FF" size="2">txt</font><font color="#EEEEEE" size="2"> y serat afficher.</font></pre>
</div>

<p align="left"><font size="2"></font>&nbsp;</p>
<div align="left">

<pre><font color="#EEEEEE" size="3" face="Times New Roman"><u>Les registres:</u> Se sont des emplacement de mémoire situés à l'interieur du micropprocesseur. 
                             Ils sont au nombre de 14 et on peut les répartir en 4 catégories:
                            - Les registres de segment	(CS, DS, SS, ES)
                            - Les regsitres de travail 	(AX, BX, CX, CX)
                            - Les registrs d'offset 		(SI, DI, IP, BP, SP)
                            - Le regsitre FLAG 		(indicateurs: CF, PF, AF, ZF, SF, OF)
                            Mais comme nous sommes en 32 bits, alors par exemple:
                            BP deviendra EBP et ainsi de suite.. </font><font
color="#EEEEEE" size="4" face="Times New Roman">
</font></pre>
</div>

<p align="center"><font color="#EEEEEE" size="3">
-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-</font></p>

<p><font size="3"></font>&nbsp;</p>

<p align="center">&nbsp;</p>

</body>
</html>
