<html>

<!-- Mirrored from frenchezines.free.fr/tries/shmeitcorp/5/Malade/1%20-%20Keygenme%20-%20JuLio%20eL%20NeGRo.html by HTTrack Website Copier/3.x [XR&CO'2007], Thu, 07 Aug 2008 04:41:16 GMT -->
<head>
<title>Keygenme - JuLio eL NeGRo</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"></head>
<body bgcolor="#000000" text="#FFFFFF" link="#FFFFFF" vlink="#FFFFFF" alink="#FFFFFF" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<table width="670" border="0">
  <tr> 
    <td><p><font size="2" face="Arial, Helvetica, sans-serif"><b>Keygenme - JuLio 
        eL NeGRo [<a href="Malade/1%20-%20Keygenme%20-%20JuLio%20eL%20NeGRo.zip">zip</a>]</b></font></p>
      <ul>
        <li><font size="2" face="Arial, Helvetica, sans-serif"><b>Type de la protection 
          :</b> nom / numéro de série </font>
        <li><font size="2" face="Arial, Helvetica, sans-serif"><b>Méthode utilisée 
          :</b> reversing</font>
        <li><font size="2" face="Arial, Helvetica, sans-serif"><b>Outils utilisés 
          :</b> </font><font face="Arial, Helvetica, sans-serif"> 
          <ul>
            <font size="2"> désassembleur (IDA v4.1.7.600)<br>
            <a href="http://home.t-online.de/home/Ollydbg/" target="_blank">debugger 
            (OllyDbg v1.06)<br>
            </a><a href="http://www.bpsoft.com/" target="_blank">éditeur hexadécimal 
            (Hex Workshop v3.11)</a></font> 
          </ul>
          </font>
      </ul>
      <p><font size="2" face="Arial, Helvetica, sans-serif"> Dans ce tutoriel, 
        nous allons étudier comment transformer un programme en son propre keygener 
        quand vous avez un peu de mal à le keygener, ou si vous n'avez pas vraiment 
        le temps. On exécute le fichier exécutable, on clique sur le bouton 'Check' 
        et une fenêtre apparaît avec comme message 'Wrong Serial !'.<br>
        <br>
        On va donc chercher toute relation avec ce message, comment apparaît-il, 
        etc... On ouvre alors le fichier exécutable avec IDA (je n'utilise pas 
        W32Dasm tout simplement parce qu'il ne fonctionne pas chez moi, et IDA 
        est très pratique, pour cela allez voir les tutz de Netix sur IDA).</font></p>
      <p><font size="2" face="Arial, Helvetica, sans-serif">On va dans le menu 
        '<strong>Search</strong>' puis '<strong>text...</strong>', on entre 'Wrong 
        Serial !' dans le champ, puis 'OK'.<br>
        On arrive alors à cette ligne :<br>
        </font><font size="2" face="Courier New, Courier, mono"><font color="#FFFF00"><br>
        .data:004060AF</font> <font color="#C0C0C0">aWrongSerial db</font> <font color="#00FF00">'Wrong 
        Serial !',0</font> <font color="#00FFFF">; DATA XREF: sub_4043A3+66|o</font></font><font size="2" face="Arial, Helvetica, sans-serif"> 
        </font></p>
      <font size="2" face="Arial, Helvetica, sans-serif">En jaune nous avons l'adresse 
      en mémoire dans le programme, ensuite le nom de la variable, le type de 
      la variable, puis la valeur affectée à la variable. En commentaire, IDA 
      nous indique dans quel endroit du programme cette variable est appelée. 
      On double-clique donc sur sub_4043A3+66, et on arrive ici : <br>
      <br>
      </font><font size="2" face="Courier New, Courier, mono"><font color="#C0C0C0">.text:00404402 
      push</font> <font color="#00FFFF">0</font> <font color="#000000">...................</font><font color="#FFFFFF">; 
      uType<br>
      </font><font color="#C0C0C0">.text:00404404 push offset aError</font> <font color="#000000">.......</font><font color="#FFFFFF">; 
      lpCaption<br>
      </font><font color="#FFFF00">.text:00404409</font> <font color="#C0C0C0">push 
      offset aWrongSerial</font> <font color="#000000">.</font><font color="#FFFFFF">; 
      lpText<br>
      </font><font color="#C0C0C0">.text:0040440E push [ebp+</font><font color="#00FF00">hWnd</font><font color="#C0C0C0">]</font> 
      <font color="#FFFFFF">; hWnd<br>
      </font><font color="#C0C0C0">.text:00404411</font> <font color="#C0C0C0">call</font> 
      <font color="#FFFF00">MessageBoxA</font></font><font size="2" face="Arial, Helvetica, sans-serif"> 
      <br>
      </font> <p><font size="2" face="Arial, Helvetica, sans-serif"> On voit bien 
        ici l'appel à la MessageBox !<br>
        </font><font size="2" face="Arial, Helvetica, sans-serif">Nous avons en 
        paramètre de la MessageBox le type (ici juste le bouton OK), l'adresse 
        du texte de la barre de titre, l'adresse du texte de la boîte, et enfin 
        le handle du programme pour attacher la boîte au programme.<br>
        On a déjà une idée où poser un breakpoint. On retient donc l'adresse <strong>00404409</strong>.<br>
        <br>
        On exécute OllyDbg et on ouvre le crackme, ensuite on fait soit un clic-droit, 
        'Go to' et 'Expression', soit <strong>Ctrl+G</strong>, on entre l'adresse 
        et 'OK'. On voit clairement les 2 appels MessageBox selon le résultat 
        de la vérification.<br>
        On remonte légèrement, et voici ce qu'on observe : </font></p>
      <p><font size="2" face="Courier New, Courier, mono">004043F4 |. E8 51000000 
        <font color="#000000">..</font>CALL Keygenm.0040444A<br>
        004043F9 |. E8 AB000000 <font color="#000000">..</font>CALL Keygenm.004044A9<br>
        004043FE |. 85C0 <font color="#000000">...</font><font color="#000000">...</font><font color="#000000">...</font>TEST 
        EAX,EAX<br>
        00404400 |. 75 16 <font color="#000000">...</font><font color="#000000">...</font><font color="#000000">..</font>JNZ 
        SHORT Keygenm.00404418<br>
        00404402 |. 6A 00 <font color="#000000">...</font><font color="#000000">...</font><font color="#000000">..</font>PUSH 
        0 <font color="#000000">..................</font><font size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#000000">..</font><font color="#000000">.</font><font color="#000000">.</font>; 
        /<font color="#999999">Style =</font><font size="2" face="Courier New, Courier, mono"><font color="#999999"> 
        </font></font><font color="#999999"><font size="1">MB_OK|MB_APPLMODAL</font></font><br>
        00404404 |. 68 BE604000 <font color="#000000">..</font>PUSH Keygenm.004060BE 
        <font color="#000000">...</font><font size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#000000">.</font><font size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#000000">.</font><font size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#000000">.</font>; 
        |<font color="#999999">Title = &quot;error&quot;</font><br>
        00404409 |. 68 AF604000 <font color="#000000">..</font>PUSH Keygenm.004060AF 
        <font color="#000000">.....</font><font size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#000000">.</font><font size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#000000">.</font>; 
        |<font color="#999999">Text = &quot;Wrong Serial !&quot;</font><br>
        0040440E |. FF75 08 <font color="#000000">...</font><font color="#000000">...</font>PUSH 
        DWORD PTR SS:[EBP+8] <font color="#000000">...</font><font color="#000000">.</font><font color="#000000">.</font>; 
        |<font color="#999999">hOwner</font><br>
        00404411 |. E8 0A010000 <font color="#000000">..</font>CALL &lt;JMP.&amp;USER32.MessageBoxA&gt; 
        ; \<font color="#FF0000">MessageBoxA</font><br>
        00404416 |. EB 14 <font color="#000000">...</font><font color="#000000">...</font><font color="#000000">..</font>JMP 
        SHORT Keygenm.0040442C<br>
        00404418 |&gt; 6A 00 <font color="#000000">...</font><font color="#000000">...</font><font color="#000000">..</font>PUSH 
        0 <font color="#000000">........................</font>; /<font color="#999999">Style 
        = <font size="1">MB_OK|MB_APPLMODAL</font></font><br>
        0040441A |. 68 A7604000 <font color="#000000">..</font>PUSH Keygenm.004060A7 
        <font color="#000000">.........</font>; |<font color="#999999">Title = 
        &quot;success&quot;</font><br>
        0040441F |. 68 7C604000 <font color="#000000">..</font>PUSH Keygenm.0040607C 
        <font color="#000000">.........</font>; |<font color="#999999">Text = 
        &quot;Good Job, ...&quot;</font><br>
        00404424 |. FF75 08 <font color="#000000">...</font><font color="#000000">...</font>PUSH 
        DWORD PTR SS:[EBP+8] <font color="#000000">.... </font>; |<font color="#999999">hOwner</font><br>
        00404427 |. E8 F4000000 <font color="#000000">..</font>CALL &lt;JMP.&amp;USER32.MessageBoxA&gt; 
        ; \<font color="#FF0000">MessageBoxA</font></font><br>
        <br>
        <font size="2" face="Arial, Helvetica, sans-serif">Juste au-dessus le 
        premier call MessageBox le programme effectue un test en 004043FE, on 
        peut supposer qu'il s'agit d'un test qui permet de diriger vers le bon 
        message. En effet si on regarde le code, 'test eax, eax' permet de vérifier 
        si le registre eax est à 0, s'il n'y est pas on saute en 00404418, or 
        à cette adresse c'est le call qui affiche le test de réussite ! Si on 
        désirait cracker le prog il faudrait remplacer le JNZ par un JMP qui ferait 
        sauter le programme quelque soit le numéro de série entré. Donc en 004044A9 
        on vérifie si le numéro entré est correct... Mais à quoi correspond le 
        call juste au-dessus ? Eh bien allons voir. On clique à l'adresse 004043F4 
        et on pose le breakpoint en tapant F2, on relance le prog en faisant Ctrl+F2, 
        on fait 'Oui', F9, le bouton 'Check' du crackme et nous voilà sur cette 
        ligne. Pour rentrer dans le call on fait F7, et on arrive ici : </font></p>
      <p><font size="2" face="Courier New, Courier, mono">0040444A /$ 6A 32 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">PUSH 
        32 <font color="#000000">..........................</font>; /<font color="#999999">Count 
        = 32 (50.)</font><br>
        0040444C |. 68 6C614000 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"></font><font size="2" face="Courier New, Courier, mono">PUSH 
        Keygenme.0040616C <font color="#000000">......</font><font size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#000000">.</font><font color="#000000">.</font><font color="#000000">.</font><font color="#000000">.</font>; 
        |<font color="#999999">Buffer = <font size="1">Keygenme.0040616C</font></font><br>
        00404451 |. FF35 A8684000 PUSH DWORD PTR DS:[4068A8] <font color="#000000">....</font><font size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#000000">.</font><font color="#000000">.</font>; 
        |<font color="#999999">hWnd = 000502BC </font><br>
        00404457 |. E8 AC000000 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"></font><font size="2" face="Courier New, Courier, mono">CALL 
        &lt;JMP.&amp;USER32.GetWindowTextA&gt; ; \<font color="#FF0000">GetWindowTextA</font></font> 
      </p>
      <p><font size="2" face="Arial, Helvetica, sans-serif"> On cherche donc ici 
        à récupérer un des champs rentré dans un buffer (adresse où on stockera 
        les données récupérées) à l'adresse 0040616C de taille maximale 50 caractères 
        (32 en hexadécimal). En faisant F8 et en allant voir à l'adresse 0040616C, 
        on remarque qu'il charge en fait notre nom (pour cela faîtes un dump de 
        la section .data sous OllyDbg et allez à l'adresse voulue. Ensuite le 
        programme génère un numéro de série correspondant au nom entré : </font></p>
      <p><font size="2" face="Courier New, Courier, mono">0040445C |. 0BC0 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font size="2" face="Courier New, Courier, mono">OR 
        EAX,EAX<br>
        0040445E |. 74 48 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">JE 
        SHORT Keygenme.004044A8<br>
        00404460 |. 68 6C614000 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font size="2" face="Courier New, Courier, mono">PUSH 
        Keygenme.0040616C <font color="#000000">............</font>; <font color="#999999">ASCII 
        &quot;Le_MaLaDe&quot;</font><br>
        00404465 |. 50 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">PUSH 
        EAX<br>
        00404466 |. 68 6C654000 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font size="2" face="Courier New, Courier, mono">PUSH 
        Keygenme.0040656C<br>
        0040446B |. E8 90CBFFFF </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">CALL 
        Keygenme.00401000<br>
        00404470 |. BE 6C654000 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000"> 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">MOV 
        ESI,Keygenme.0040656C<br>
        00404475 |. 33C9 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">XOR 
        ECX,ECX<br>
        00404477 |. 33C0 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">XOR 
        EAX,EAX<br>
        00404479 |&gt; 33DB </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">XOR 
        EBX,EBX<br>
        0040447B |. 8A1C31 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">MOV 
        BL,BYTE PTR DS:[ECX+ESI]<br>
        0040447E |. 84DB </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">TEST 
        BL,BL<br>
        00404480 |. 74 0E </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"></font><font size="2" face="Courier New, Courier, mono">JE 
        SHORT Keygenme.00404490<br>
        00404482 |. 0FAFD9 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">IMUL 
        EBX,ECX<br>
        00404485 |. 0FAFDB </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">IMUL 
        EBX,EBX<br>
        00404488 |. 83C3 50 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font><font size="2" face="Courier New, Courier, mono"> 
        </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"></font></font><font size="2" face="Courier New, Courier, mono">ADD 
        EBX,50<br>
        0040448B |. 03C3 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">ADD 
        EAX,EBX<br>
        0040448D |. 41 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font size="2" face="Courier New, Courier, mono">INC 
        ECX<br>
        0040448E |.^EB E9 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"> </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"></font><font size="2" face="Courier New, Courier, mono">JMP 
        SHORT Keygenme.00404479<br>
        00404490 |&gt; 35 78563412 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"></font><font size="2" face="Courier New, Courier, mono">XOR 
        EAX,12345678<br>
        00404495 |. 50 PUSH EAX <font color="#000000">....................................</font><font color="#000000">.</font>; 
        /<font color="#999999">&lt;%lu&gt;</font><br>
        00404496 |. 68 78604000 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"></font><font size="2" face="Courier New, Courier, mono">PUSH 
        Keygenme.00406078 <font color="#000000">............</font>; |<font color="#999999">Format 
        = &quot;%lu&quot;</font><br>
        0040449B |. 68 6C674000 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono"></font><font size="2" face="Courier New, Courier, mono"> 
        PUSH Keygenme.0040676C <font color="#000000">............</font>; |<font color="#999999">s=Keygenme.0040676C</font><br>
        004044A0 |. E8 45000000 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">. 
        </font></font><font size="2" face="Courier New, Courier, mono">CALL &lt;JMP.&amp;USER32.wsprintfA&gt; 
        <font color="#000000">......</font>; \<font color="#FF0000">wsprintfA</font><br>
        004044A5 |. 83C4 0C </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">......</font></font><font size="2" face="Courier New, Courier, mono">ADD 
        ESP,0C<br>
        004044A8 \&gt; C3 </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">...........</font></font><font size="2" face="Courier New, Courier, mono">RETN<br>
        </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono">004044DA 
        |. 47<font color="#000000">............</font>INC EDI</font><font size="2" face="Courier New, Courier, mono"> 
        </font></p>
      <p><font size="2" face="Arial, Helvetica, sans-serif"> La première instruction 
        vérifie si le nombre de caractères lus est 0, si oui on quitte le call, 
        sinon on continue.<br>
        On appelle une fonction avec comme arguments le nom entré, le nombre de 
        caractères du nom, puis une adresse. Après le call, on place dans le registre 
        ESI l'adresse utilisée par le call, il s'agissait en fait d'un buffer.<br>
        <br>
        On initialise ECX et EAX. On initialise ensuite EBX à 0, on va boucler 
        sur la chaîne obtenue précédemment.<br>
        On effectue quelques opérations pour chaque caractère lu, puis on formate 
        la chaîne ainsi obtenue en entier.<br>
        On sort du call, vous verrez pourquoi par la suite pourquoi je n'explique 
        pas la routine.<br>
        On rentre dans le call qui suit, qui normalement vérifie le numéro de 
        série : </font></p>
      <p><font color="#FFFFFF" size="2" face="Courier New, Courier, mono">004044A9 
        /$ 6A 32 <font color="#000000">........</font>PUSH 32 <font color="#000000">.....................</font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#000000">.</font><font color="#000000">.</font><font color="#000000">.</font><font color="#000000">.</font>; 
        /<font color="#999999">Count = 32 (50.)</font><br>
        004044AB |. 68 6C634000 <font color="#000000">..</font>PUSH Keygenme.0040636C 
        <font color="#000000">....</font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">..</font></font><font color="#000000">..</font><font color="#000000">.</font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font></font><font color="#000000">.</font></font>; 
        |<font color="#999999">Buffer = <font size="1">Keygenme.0040636C</font></font><br>
        004044B0 |. FF35 A4684000 PUSH DWORD PTR DS:[4068A4]<font color="#000000">.</font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">..</font></font><font color="#000000">.....</font>; 
        |<font color="#999999">hWnd = 000602C4</font><br>
        004044B6 |. E8 4D000000 <font color="#000000">..</font>CALL &lt;JMP.&USER32.GetWindowTextA&gt; 
        ; \<font color="#FF0000">GetWindowTextA</font><br>
        004044BB |. 0BC0 <font color="#000000">.........</font>OR EAX,EAX<br>
        004044BD |. 74 29 <font color="#000000">........</font>JE SHORT Keygenme.004044E8<br>
        004044BF |. 33C9 <font color="#000000">.........</font>XOR ECX,ECX<br>
        004044C1 |. 33D2 <font color="#000000">.........</font>XOR EDX,EDX<br>
        004044C3 |. 33DB <font color="#000000">.........</font>XOR EBX,EBX<br>
        004044C5 |. 33FF <font color="#000000">.........</font>XOR EDI,EDI<br>
        004044C7 |> 8B91 6C634000 MOV EDX,DWORD PTR DS:[ECX+40636C]<br>
        004044CD |. 8B99 6C674000 MOV EBX,DWORD PTR DS:[ECX+40676C]<br>
        004044D3 |. 33D3 <font color="#000000">.......</font><font color="#000000">.</font><font color="#000000">.</font>XOR 
        EDX,EBX<br>
        004044D5 |. 75 0F <font color="#000000">......</font><font color="#000000">.</font><font color="#000000">.</font>JNZ 
        SHORT Keygenme.004044E6<br>
        004044D7 |. 83C1 04 <font color="#000000">....</font><font color="#000000">.</font><font color="#000000">.</font>ADD 
        ECX,4<br>
        004044DA |. 47<font color="#000000">..........</font><font color="#000000">.</font><font color="#000000">.</font>INC 
        EDI<br>
        004044DB |. 3BF8 <font color="#000000">.......</font><font color="#000000">.</font><font color="#000000">.</font>CMP 
        EDI,EAX<br>
        004044DD |.^7C E8 <font color="#000000">......</font><font color="#000000">.</font><font color="#000000">.</font>JL 
        SHORT Keygenme.004044C7<br>
        004044DF |. B8 01000000 <font color="#000000">.</font><font color="#000000">.</font>MOV 
        EAX,1<br>
        004044E4 |. EB 02 <font color="#000000">......</font><font color="#000000">.</font><font color="#000000">.</font>JMP 
        SHORT Keygenme.004044E8<br>
        004044E6 |> 33C0 <font color="#000000">.......</font><font color="#000000">.</font><font color="#000000">.</font>XOR 
        EAX,EAX<br>
        004044E8 \> C3 <font color="#000000">.........</font><font color="#000000">.</font><font color="#000000">.</font>RETN</font></p>
      <p><font size="2" face="Arial, Helvetica, sans-serif">Et là bingo il s'agit 
        bien de notre routine de vérif', d'ailleurs on peut voir à la fin un 'mov 
        eax, 1', et un 'xor eax, eax', d'où le 'test eax, eax' juste après !<br>
        <br>
        On parcourt donc le bon numéro de série qui se situe à l'adresse 0040676C 
        et celui entré qui est à l'adresse 40636C, on prend les 4 premiers chiffres, 
        on fait un xor sur les 2 séries de 4 chiffres prises, et si le résultat 
        est 0 c'est-à-dire les 2 séries identiques donc serial valide, on prend 
        les 4 chiffres suivants, etc... <br>
        <br>
        Si on est arrivé jusqu'au bout de la boucle sans sortir, on met EAX à 
        1 (numéro de série valide), sinon EAX est à 0<br>
        :-((( Ok, on sait donc où se trouve notre numéro de série valide, mais 
        dans tout ça, comment se génère-t-il ? <br>
        <br>
        <strong>Ben c'est là qu'on va se servir du reversing plutôt que de keygener 
        &agrave; proprement dit.<br>
        </strong></font><font size="2" face="Arial, Helvetica, sans-serif"><br>
        Si on veut observer comment se génère le premier numéro on entre dans 
        le <strong>call 00401000</strong> qui se situe à l'adresse <strong>0040446B</strong>, 
        et là que voit-on ? A peu près 3000 lignes d'assembleur... Alors bon, 
        j'ai cherché à comprendre au début, mais quand j'ai vu qu'il y avait 3000 
        lignes comme ça, je me suis dit, bon on verra plus tard pour le keygener, 
        et là m'est venu une idée, oui oui. On sait donc que le bon numéro de 
        série se trouve à l'adresse 0040676C, et quand on rentre un numéro de 
        série au hasard on a toujours le message d'erreur (à moins de tomber par 
        hasard dessus mais alors là je serais sur le cul franchement !).</font></p>
      <p><font size="2" face="Arial, Helvetica, sans-serif">Quand on fait notre 
        appel à MessageBox, on a vu que les messages étaient passé en argument 
        par un push, et si au lieu d'afficher le message d'erreur on affichait 
        le numéro de série valide ? Puis ça change de toujours keygener en plus. 
        Hum, essayons, revenons donc à l'adresse 00404409 : </font></p>
      <p><font color="#FFFFFF" size="2" face="Courier New, Courier, mono">00404402 
        |. 6A 00 <font color="#000000">......</font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font><font color="#000000">.</font></font>PUSH 
        0 <font color="#000000">........................</font>; /</font><font color="#999999" size="2" face="Courier New, Courier, mono">Style=<font size="1">MB_OK|MB_APPLMODAL</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><br>
        00404404 |. 68 BE604000 <font color="#000000">.</font><font color="#000000">.</font>PUSH 
        Keygenm.004060BE <font color="#000000">.......</font><font color="#000000">.</font><font color="#000000">.</font>; 
        |<font color="#999999">Title = "error"</font><br>
        00404409 |. 68 AF604000 <font color="#000000">.</font><font color="#000000">.</font>PUSH 
        Keygenm.004060AF <font color="#000000">.......</font><font color="#000000">.</font><font color="#000000">.</font>; 
        |<font color="#999999">Text = "Wrong Serial !"</font><br>
        0040440E |. FF75 08 <font color="#000000">....</font><font color="#000000">.</font><font color="#000000">.</font>PUSH 
        DWORD PTR SS:[EBP+8] <font color="#000000">...</font><font color="#000000">.</font><font color="#000000">.</font>; 
        |<font color="#999999">hOwner</font> <br>
        00404411 |. E8 0A010000 <font color="#000000">.</font><font color="#000000">.</font>CALL 
        &lt;JMP.&USER32.MessageBoxA&gt; ; \<font color="#FF0000">MessageBoxA</font></font> 
      </p>
      <p><font size="2" face="Arial, Helvetica, sans-serif">On doucle-clique sur 
        'PUSH Keygenm.004060AF' pour pouvoir changer le code assembleur, on le 
        remplace par 'PUSH 40676C', on clique sur 'Assemble', on continue l'exécution 
        du programme en faisant F9, on entre notre nom, 'Check', et que voit-on 
        ? Plus de message d'erreur mais le numéro qui apparaît :o)))</font></p>
      <p><font size="2" face="Arial, Helvetica, sans-serif">On prend donc notre 
        éditeur hexa, on note la modification à effectuer ici '68AF604000'.<br>
        Dans Hex Workshop on fait 'Edit', 'Find...', puis on choisit 'Hex Values', 
        on entre notre valeur, puis 'OK'.<br>
        <br>
        Quand on a modifié notre code dans OllyDbg, le nouveau code est apparu 
        en rouge : <br>
        <br>
        </font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono">00404402 
        |. 6A 00 <font color="#000000">......</font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><font color="#000000">.</font><font color="#000000">.</font></font>PUSH 
        0 <font color="#000000">........................</font>; /</font><font color="#999999" size="2" face="Courier New, Courier, mono">Style=<font size="1">MB_OK|MB_APPLMODAL</font></font><font color="#FFFFFF" size="2" face="Courier New, Courier, mono"><br>
        00404404 |. 68 BE604000 <font color="#000000">.</font><font color="#000000">.</font>PUSH 
        Keygenm.004060BE <font color="#000000">.......</font><font color="#000000">.</font><font color="#000000">.</font>; 
        |<font color="#999999">Title = "error"</font><br>
        00404409 |. 68 <font color="#FF0000">6C67</font>4000 <font color="#000000">..</font><font color="#FF0000">PUSH 
        Keygenm.0040676C</font> <font color="#000000">.........</font>; |<font color="#999999">Text 
        = "Wrong Serial !"</font><br>
        0040440E |. FF75 08 <font color="#000000">....</font><font color="#000000">.</font><font color="#000000">.</font>PUSH 
        DWORD PTR SS:[EBP+8] <font color="#000000">...</font><font color="#000000">.</font><font color="#000000">.</font>; 
        |<font color="#999999">hOwner</font> <br>
        00404411 |. E8 0A010000 <font color="#000000">.</font><font color="#000000">.</font>CALL 
        &lt;JMP.&USER32.MessageBoxA&gt; ; \<font color="#FF0000">MessageBoxA</font></font> 
      </p>
      <p><font size="2" face="Arial, Helvetica, sans-serif">On remplace donc les 
        octets 'AF60' par '6C67', on sauvegarde, et le tour est joué !<br>
        On exécute notre programme modifié, on rentre le nom, 'Check', et le message 
        d'erreur s'affiche avec notre numéro de série correspondant, on le note, 
        on entre ce numéro, on réessaie, et le bon message s'affiche !</font></p>
      <p><font size="2" face="Arial, Helvetica, sans-serif"><img src="images/le_malade.jpg" width="192" height="32"></font></p></td>
  </tr>
</table>
</body>

<!-- Mirrored from frenchezines.free.fr/tries/shmeitcorp/5/Malade/1%20-%20Keygenme%20-%20JuLio%20eL%20NeGRo.html by HTTrack Website Copier/3.x [XR&CO'2007], Thu, 07 Aug 2008 04:41:16 GMT -->
</html>